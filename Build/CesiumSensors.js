/**
 * Cesium Sensors - https://github.com/AnalyticalGraphicsInc/cesium-sensors
 *
 * Copyright 2011-2014 Analytical Graphics Inc. and Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Portions licensed separately.
 * See https://github.com/AnalyticalGraphicsInc/cesium-sensors/blob/master/LICENSE.md for full licensing details.
 */

/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(){var e,i,t;!function(r){function n(e,i){return S.call(e,i)}function o(e,i){var t,r,n,o,s,a,l,u,c,h,d,m=i&&i.split("/"),C=v.map,f=C&&C["*"]||{};if(e&&"."===e.charAt(0))if(i){for(m=m.slice(0,m.length-1),e=e.split("/"),s=e.length-1,v.nodeIdCompat&&w.test(e[s])&&(e[s]=e[s].replace(w,"")),e=m.concat(e),c=0;c<e.length;c+=1)if(d=e[c],"."===d)e.splice(c,1),c-=1;else if(".."===d){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((m||f)&&C){for(t=e.split("/"),c=t.length;c>0;c-=1){if(r=t.slice(0,c).join("/"),m)for(h=m.length;h>0;h-=1)if(n=C[m.slice(0,h).join("/")],n&&(n=n[r])){o=n,a=c;break}if(o)break;!l&&f&&f[r]&&(l=f[r],u=c)}!o&&l&&(o=l,a=u),o&&(t.splice(0,a,o),e=t.join("/"))}return e}function s(e,i){return function(){return m.apply(r,y.call(arguments,0).concat([e,i]))}}function a(e){return function(i){return o(i,e)}}function l(e){return function(i){p[e]=i}}function u(e){if(n(_,e)){var i=_[e];delete _[e],g[e]=!0,d.apply(r,i)}if(!n(p,e)&&!n(g,e))throw new Error("No "+e);return p[e]}function c(e){var i,t=e?e.indexOf("!"):-1;return t>-1&&(i=e.substring(0,t),e=e.substring(t+1,e.length)),[i,e]}function h(e){return function(){return v&&v.config&&v.config[e]||{}}}var d,m,C,f,p={},_={},v={},g={},S=Object.prototype.hasOwnProperty,y=[].slice,w=/\.js$/;C=function(e,i){var t,r=c(e),n=r[0];return e=r[1],n&&(n=o(n,i),t=u(n)),n?e=t&&t.normalize?t.normalize(e,a(i)):o(e,i):(e=o(e,i),r=c(e),n=r[0],e=r[1],n&&(t=u(n))),{f:n?n+"!"+e:e,n:e,pr:n,p:t}},f={require:function(e){return s(e)},exports:function(e){var i=p[e];return"undefined"!=typeof i?i:p[e]={}},module:function(e){return{id:e,uri:"",exports:p[e],config:h(e)}}},d=function(e,i,t,o){var a,c,h,d,m,v,S=[],y=typeof t;if(o=o||e,"undefined"===y||"function"===y){for(i=!i.length&&t.length?["require","exports","module"]:i,m=0;m<i.length;m+=1)if(d=C(i[m],o),c=d.f,"require"===c)S[m]=f.require(e);else if("exports"===c)S[m]=f.exports(e),v=!0;else if("module"===c)a=S[m]=f.module(e);else if(n(p,c)||n(_,c)||n(g,c))S[m]=u(c);else{if(!d.p)throw new Error(e+" missing "+c);d.p.load(d.n,s(o,!0),l(c),{}),S[m]=p[c]}h=t?t.apply(p[e],S):void 0,e&&(a&&a.exports!==r&&a.exports!==p[e]?p[e]=a.exports:h===r&&v||(p[e]=h))}else e&&(p[e]=t)},e=i=m=function(e,i,t,n,o){if("string"==typeof e)return f[e]?f[e](i):u(C(e,i).f);if(!e.splice){if(v=e,v.deps&&m(v.deps,v.callback),!i)return;i.splice?(e=i,i=t,t=null):e=r}return i=i||function(){},"function"==typeof t&&(t=n,n=o),n?d(r,e,i,t):setTimeout(function(){d(r,e,i,t)},4),m},m.config=function(e){return m(e)},e._defined=p,t=function(e,i,t){i.splice||(t=i,i=[]),n(p,e)||n(_,e)||(_[e]=[e,i,t])},t.amd={jQuery:!0}}(),t("ConicSensorGraphics",["Cesium/Core/defaultValue","Cesium/Core/defined","Cesium/Core/defineProperties","Cesium/Core/DeveloperError","Cesium/Core/Event","Cesium/DataSources/createPropertyDescriptor"],function(e,i,t,r,n,o){"use strict";var s=function(){this._minimumClockAngle=void 0,this._minimumClockAngleSubscription=void 0,this._maximumClockAngle=void 0,this._maximumClockAngleSubscription=void 0,this._innerHalfAngle=void 0,this._innerHalfAngleSubscription=void 0,this._outerHalfAngle=void 0,this._outerHalfAngleSubscription=void 0,this._lateralSurfaceMaterial=void 0,this._lateralSurfaceMaterialSubscription=void 0,this._intersectionColor=void 0,this._intersectionColorSubscription=void 0,this._intersectionWidth=void 0,this._intersectionWidthSubscription=void 0,this._showIntersection=void 0,this._showIntersectionSubscription=void 0,this._radius=void 0,this._radiusSubscription=void 0,this._show=void 0,this._showSubscription=void 0,this._definitionChanged=new n};return t(s.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},minimumClockAngle:o("minimumClockAngle"),maximumClockAngle:o("maximumClockAngle"),innerHalfAngle:o("innerHalfAngle"),outerHalfAngle:o("outerHalfAngle"),lateralSurfaceMaterial:o("lateralSurfaceMaterial"),intersectionColor:o("intersectionColor"),intersectionWidth:o("intersectionWidth"),showIntersection:o("showIntersection"),radius:o("radius"),show:o("show")}),s.prototype.clone=function(e){return i(e)||(e=new s),e.show=this.show,e.innerHalfAngle=this.innerHalfAngle,e.outerHalfAngle=this.outerHalfAngle,e.minimumClockAngle=this.minimumClockAngle,e.maximumClockAngle=this.maximumClockAngle,e.radius=this.radius,e.showIntersection=this.showIntersection,e.intersectionColor=this.intersectionColor,e.intersectionWidth=this.intersectionWidth,e.lateralSurfaceMaterial=this.lateralSurfaceMaterial,e},s.prototype.merge=function(i){this.show=e(this.show,i.show),this.innerHalfAngle=e(this.innerHalfAngle,i.innerHalfAngle),this.outerHalfAngle=e(this.outerHalfAngle,i.outerHalfAngle),this.minimumClockAngle=e(this.minimumClockAngle,i.minimumClockAngle),this.maximumClockAngle=e(this.maximumClockAngle,i.maximumClockAngle),this.radius=e(this.radius,i.radius),this.showIntersection=e(this.showIntersection,i.showIntersection),this.intersectionColor=e(this.intersectionColor,i.intersectionColor),this.intersectionWidth=e(this.intersectionWidth,i.intersectionWidth),this.lateralSurfaceMaterial=e(this.lateralSurfaceMaterial,i.lateralSurfaceMaterial)},s}),t("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),t("text!CustomSensorVolumeFS.glsl",[],function(){return'#ifdef GL_OES_standard_derivatives\r\n    #extension GL_OES_standard_derivatives : enable\r\n#endif  \r\n\r\nuniform bool u_showIntersection;\r\nuniform bool u_showThroughEllipsoid;\r\n\r\nuniform float u_sensorRadius;\r\nuniform float u_normalDirection;\r\n\r\nvarying vec3 v_positionWC;\r\nvarying vec3 v_positionEC;\r\nvarying vec3 v_normalEC;\r\n\r\nvec4 getColor(float sensorRadius, vec3 pointEC)\r\n{\r\n    czm_materialInput materialInput;\r\n    \r\n    vec3 pointMC = (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;                                \r\n    materialInput.st = sensor2dTextureCoordinates(sensorRadius, pointMC);   \r\n    materialInput.str = pointMC / sensorRadius;\r\n    \r\n    vec3 positionToEyeEC = -v_positionEC;\r\n    materialInput.positionToEyeEC = positionToEyeEC;\r\n    \r\n    vec3 normalEC = normalize(v_normalEC);\r\n    materialInput.normalEC = u_normalDirection * normalEC;\r\n    \r\n    czm_material material = czm_getMaterial(materialInput);\r\n    return mix(czm_phong(normalize(positionToEyeEC), material), vec4(material.diffuse, material.alpha), 0.4);\r\n}\r\n\r\nbool isOnBoundary(float value, float epsilon)\r\n{\r\n    float width = getIntersectionWidth();\r\n    float tolerance = width * epsilon;\r\n\r\n#ifdef GL_OES_standard_derivatives\r\n    float delta = max(abs(dFdx(value)), abs(dFdy(value)));\r\n    float pixels = width * delta;\r\n    float temp = abs(value);\r\n    // There are a couple things going on here.\r\n    // First we test the value at the current fragment to see if it is within the tolerance.\r\n    // We also want to check if the value of an adjacent pixel is within the tolerance,\r\n    // but we don\'t want to admit points that are obviously not on the surface.\r\n    // For example, if we are looking for "value" to be close to 0, but value is 1 and the adjacent value is 2,\r\n    // then the delta would be 1 and "temp - delta" would be "1 - 1" which is zero even though neither of\r\n    // the points is close to zero.\r\n    return temp < tolerance && temp < pixels || (delta < 10.0 * tolerance && temp - delta < tolerance && temp < pixels);\r\n#else\r\n    return abs(value) < tolerance;\r\n#endif\r\n}\r\n\r\nvec4 shade(bool isOnBoundary)\r\n{\r\n    if (u_showIntersection && isOnBoundary)\r\n    {\r\n        return getIntersectionColor();\r\n    }\r\n    return getColor(u_sensorRadius, v_positionEC);\r\n}\r\n\r\nfloat ellipsoidSurfaceFunction(czm_ellipsoid ellipsoid, vec3 point)\r\n{\r\n    vec3 scaled = ellipsoid.inverseRadii * point;\r\n    return dot(scaled, scaled) - 1.0;\r\n}\r\n\r\nvoid main()\r\n{\r\n    vec3 sensorVertexWC = czm_model[3].xyz;      // (0.0, 0.0, 0.0) in model coordinates\r\n    vec3 sensorVertexEC = czm_modelView[3].xyz;  // (0.0, 0.0, 0.0) in model coordinates\r\n\r\n    czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\r\n    float ellipsoidValue = ellipsoidSurfaceFunction(ellipsoid, v_positionWC);\r\n\r\n    // Occluded by the ellipsoid?\r\n	if (!u_showThroughEllipsoid)\r\n	{\r\n	    // Discard if in the ellipsoid    \r\n	    // PERFORMANCE_IDEA: A coarse check for ellipsoid intersection could be done on the CPU first.\r\n	    if (ellipsoidValue < 0.0)\r\n	    {\r\n            discard;\r\n	    }\r\n\r\n	    // Discard if in the sensor\'s shadow\r\n	    if (inSensorShadow(sensorVertexWC, ellipsoid, v_positionWC))\r\n	    {\r\n	        discard;\r\n	    }\r\n    }\r\n\r\n    // Discard if not in the sensor\'s sphere\r\n    // PERFORMANCE_IDEA: We can omit this check if the radius is Number.POSITIVE_INFINITY.\r\n    if (distance(v_positionEC, sensorVertexEC) > u_sensorRadius)\r\n    {\r\n        discard;\r\n    }\r\n    \r\n    // Notes: Each surface functions should have an associated tolerance based on the floating point error.\r\n    bool isOnEllipsoid = isOnBoundary(ellipsoidValue, czm_epsilon3);\r\n    gl_FragColor = shade(isOnEllipsoid);\r\n}\r\n'}),t("text!CustomSensorVolumeVS.glsl",[],function(){return"attribute vec4 position;\r\nattribute vec3 normal;\r\n\r\nvarying vec3 v_positionWC;\r\nvarying vec3 v_positionEC;\r\nvarying vec3 v_normalEC;\r\n\r\nvoid main()\r\n{\r\n    gl_Position = czm_modelViewProjection * position;\r\n    v_positionWC = (czm_model * position).xyz;\r\n    v_positionEC = (czm_modelView * position).xyz;\r\n    v_normalEC = czm_normal * normal;\r\n}"}),t("text!SensorVolume.glsl",[],function(){return"uniform vec4 u_intersectionColor;\r\nuniform float u_intersectionWidth;\r\n\r\nbool inSensorShadow(vec3 coneVertexWC, czm_ellipsoid ellipsoidEC, vec3 pointWC)\r\n{\r\n    // Diagonal matrix from the unscaled ellipsoid space to the scaled space.    \r\n    vec3 D = ellipsoidEC.inverseRadii;\r\n\r\n    // Sensor vertex in the scaled ellipsoid space\r\n    vec3 q = D * coneVertexWC;\r\n    float qMagnitudeSquared = dot(q, q);\r\n    float test = qMagnitudeSquared - 1.0;\r\n    \r\n    // Sensor vertex to fragment vector in the ellipsoid's scaled space\r\n    vec3 temp = D * pointWC - q;\r\n    float d = dot(temp, q);\r\n    \r\n    // Behind silhouette plane and inside silhouette cone\r\n    return (d < -test) && (d / length(temp) < -sqrt(test));\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\nvec4 getIntersectionColor()\r\n{\r\n    return u_intersectionColor;\r\n}\r\n\r\nfloat getIntersectionWidth()\r\n{\r\n    return u_intersectionWidth;\r\n}\r\n\r\nvec2 sensor2dTextureCoordinates(float sensorRadius, vec3 pointMC)\r\n{\r\n    // (s, t) both in the range [0, 1]\r\n    float t = pointMC.z / sensorRadius;\r\n    float s = 1.0 + (atan(pointMC.y, pointMC.x) / czm_twoPi);\r\n    s = s - floor(s);\r\n    \r\n    return vec2(s, t);\r\n}\r\n"}),t("CustomSensorVolume",["Cesium/Core/BoundingSphere","Cesium/Core/Cartesian3","Cesium/Core/Color","Cesium/Core/combine","Cesium/Core/ComponentDatatype","Cesium/Core/defaultValue","Cesium/Core/defined","Cesium/Core/defineProperties","Cesium/Core/destroyObject","Cesium/Core/DeveloperError","Cesium/Core/Matrix4","Cesium/Core/PrimitiveType","Cesium/Renderer/BufferUsage","Cesium/Renderer/createShaderSource","Cesium/Renderer/DrawCommand","text!./CustomSensorVolumeFS.glsl","text!./CustomSensorVolumeVS.glsl","text!./SensorVolume.glsl","Cesium/Scene/BlendingState","Cesium/Scene/CullFace","Cesium/Scene/Material","Cesium/Scene/Pass","Cesium/Scene/SceneMode"],function(e,i,t,r,n,o,s,a,l,u,c,h,d,m,C,f,p,_,v,g,S,y,w){"use strict";function A(t){for(var r=t._directions,n=r.length,o=new Float32Array(3*n),s=isFinite(t.radius)?t.radius:b,a=[i.ZERO],l=n-2,u=n-1,c=0;n>c;l=u++,u=c++){var h=i.fromSpherical(r[l],I),d=i.fromSpherical(r[u],V),m=i.fromSpherical(r[c],D),C=Math.max(i.angleBetween(h,d),i.angleBetween(d,m)),f=s/Math.cos(.5*C),p=i.multiplyByScalar(d,f,new i);o[3*u]=p.x,o[3*u+1]=p.y,o[3*u+2]=p.z,a.push(p)}return e.fromPoints(a,t._boundingSphere),o}function M(e,t){for(var r=A(e),o=e._directions.length,s=new Float32Array(18*o),a=0,l=o-1,u=0;o>u;l=u++){var c=new i(r[3*l],r[3*l+1],r[3*l+2]),h=new i(r[3*u],r[3*u+1],r[3*u+2]),m=i.normalize(i.cross(h,c,P),P);s[a++]=0,s[a++]=0,s[a++]=0,s[a++]=m.x,s[a++]=m.y,s[a++]=m.z,s[a++]=h.x,s[a++]=h.y,s[a++]=h.z,s[a++]=m.x,s[a++]=m.y,s[a++]=m.z,s[a++]=c.x,s[a++]=c.y,s[a++]=c.z,s[a++]=m.x,s[a++]=m.y,s[a++]=m.z}var C=t.createVertexBuffer(new Float32Array(s),d.STATIC_DRAW),f=6*Float32Array.BYTES_PER_ELEMENT,p=[{index:x.position,vertexBuffer:C,componentsPerAttribute:3,componentDatatype:n.FLOAT,offsetInBytes:0,strideInBytes:f},{index:x.normal,vertexBuffer:C,componentsPerAttribute:3,componentDatatype:n.FLOAT,offsetInBytes:3*Float32Array.BYTES_PER_ELEMENT,strideInBytes:f}];return t.createVertexArray(p)}var x={position:0,normal:1},b=5906376272e3,E=function(i){i=o(i,o.EMPTY_OBJECT),this._pickId=void 0,this._pickPrimitive=o(i._pickPrimitive,this),this._frontFaceColorCommand=new C,this._backFaceColorCommand=new C,this._pickCommand=new C,this._boundingSphere=new e,this._boundingSphereWC=new e,this._frontFaceColorCommand.primitiveType=h.TRIANGLES,this._frontFaceColorCommand.boundingVolume=this._boundingSphereWC,this._frontFaceColorCommand.owner=this,this._backFaceColorCommand.primitiveType=this._frontFaceColorCommand.primitiveType,this._backFaceColorCommand.boundingVolume=this._frontFaceColorCommand.boundingVolume,this._backFaceColorCommand.owner=this,this._pickCommand.primitiveType=this._frontFaceColorCommand.primitiveType,this._pickCommand.boundingVolume=this._frontFaceColorCommand.boundingVolume,this._pickCommand.owner=this,this.show=o(i.show,!0),this.showIntersection=o(i.showIntersection,!0),this.showThroughEllipsoid=o(i.showThroughEllipsoid,!1),this._showThroughEllipsoid=this.showThroughEllipsoid,this.modelMatrix=c.clone(o(i.modelMatrix,c.IDENTITY)),this._modelMatrix=new c,this.radius=o(i.radius,Number.POSITIVE_INFINITY),this._directions=void 0,this._directionsDirty=!1,this.directions=s(i.directions)?i.directions:[],this.lateralSurfaceMaterial=s(i.lateralSurfaceMaterial)?i.lateralSurfaceMaterial:S.fromType(S.ColorType),this._lateralSurfaceMaterial=void 0,this._translucent=void 0,this.intersectionColor=t.clone(o(i.intersectionColor,t.WHITE)),this.intersectionWidth=o(i.intersectionWidth,5),this.id=i.id,this._id=void 0;var r=this;this._uniforms={u_showThroughEllipsoid:function(){return r.showThroughEllipsoid},u_showIntersection:function(){return r.showIntersection},u_sensorRadius:function(){return isFinite(r.radius)?r.radius:b},u_intersectionColor:function(){return r.intersectionColor},u_intersectionWidth:function(){return r.intersectionWidth},u_normalDirection:function(){return 1}},this._mode=w.SCENE3D};a(E.prototype,{directions:{get:function(){return this._directions},set:function(e){this._directions=e,this._directionsDirty=!0}}});var I=new i,V=new i,D=new i,P=new i;return E.prototype.update=function(i,t,n){if(this._mode=t.mode,this.show&&this._mode===w.SCENE3D){var o=this.lateralSurfaceMaterial.isTranslucent();if(this._showThroughEllipsoid!==this.showThroughEllipsoid||!s(this._frontFaceColorCommand.renderState)||this._translucent!==o){this._showThroughEllipsoid=this.showThroughEllipsoid,this._translucent=o;var a;o?(a=i.createRenderState({depthTest:{enabled:!this.showThroughEllipsoid},depthMask:!1,blending:v.ALPHA_BLEND,cull:{enabled:!0,face:g.BACK}}),this._frontFaceColorCommand.renderState=a,this._frontFaceColorCommand.pass=y.TRANSLUCENT,a=i.createRenderState({depthTest:{enabled:!this.showThroughEllipsoid},depthMask:!1,blending:v.ALPHA_BLEND,cull:{enabled:!0,face:g.FRONT}}),this._backFaceColorCommand.renderState=a,this._backFaceColorCommand.pass=y.TRANSLUCENT,a=i.createRenderState({depthTest:{enabled:!this.showThroughEllipsoid},depthMask:!1,blending:v.ALPHA_BLEND}),this._pickCommand.renderState=a):(a=i.createRenderState({depthTest:{enabled:!0},depthMask:!0}),this._frontFaceColorCommand.renderState=a,this._frontFaceColorCommand.pass=y.OPAQUE,a=i.createRenderState({depthTest:{enabled:!0},depthMask:!0}),this._pickCommand.renderState=a)}var l=this._directionsDirty;if(l){this._directionsDirty=!1,this._va=this._va&&this._va.destroy();var u=this._directions;u&&u.length>=3&&(this._frontFaceColorCommand.vertexArray=M(this,i),this._backFaceColorCommand.vertexArray=this._frontFaceColorCommand.vertexArray,this._pickCommand.vertexArray=this._frontFaceColorCommand.vertexArray)}if(s(this._frontFaceColorCommand.vertexArray)){var h=t.passes,d=!c.equals(this.modelMatrix,this._modelMatrix);d&&c.clone(this.modelMatrix,this._modelMatrix),(l||d)&&e.transform(this._boundingSphere,this.modelMatrix,this._boundingSphereWC),this._frontFaceColorCommand.modelMatrix=this.modelMatrix,this._backFaceColorCommand.modelMatrix=this._frontFaceColorCommand.modelMatrix,this._pickCommand.modelMatrix=this._frontFaceColorCommand.modelMatrix;var C=this._lateralSurfaceMaterial!==this.lateralSurfaceMaterial;if(this._lateralSurfaceMaterial=this.lateralSurfaceMaterial,this._lateralSurfaceMaterial.update(i),h.render){var S=this._frontFaceColorCommand,A=this._backFaceColorCommand;if(C||!s(S.shaderProgram)){var b=m({sources:[_,this._lateralSurfaceMaterial.shaderSource,f]});S.shaderProgram=i.replaceShaderProgram(S.shaderProgram,p,b,x),S.uniformMap=r(this._uniforms,this._lateralSurfaceMaterial._uniforms),A.shaderProgram=S.shaderProgram,A.uniformMap=r(this._uniforms,this._lateralSurfaceMaterial._uniforms),A.uniformMap.u_normalDirection=function(){return-1}}o?n.push(this._backFaceColorCommand,this._frontFaceColorCommand):n.push(this._frontFaceColorCommand)}if(h.pick){var E=this._pickCommand;if(s(this._pickId)&&this._id===this.id||(this._id=this.id,this._pickId=this._pickId&&this._pickId.destroy(),this._pickId=i.createPickId({primitive:this._pickPrimitive,id:this.id})),C||!s(E.shaderProgram)){var I=m({sources:[_,this._lateralSurfaceMaterial.shaderSource,f],pickColorQualifier:"uniform"});E.shaderProgram=i.replaceShaderProgram(E.shaderProgram,p,I,x);var V=this,D={czm_pickColor:function(){return V._pickId.color}};E.uniformMap=r(r(this._uniforms,this._lateralSurfaceMaterial._uniforms),D)}E.pass=o?y.TRANSLUCENT:y.OPAQUE,n.push(E)}}}},E.prototype.isDestroyed=function(){return!1},E.prototype.destroy=function(){return this._frontFaceColorCommand.vertexArray=this._frontFaceColorCommand.vertexArray&&this._frontFaceColorCommand.vertexArray.destroy(),this._frontFaceColorCommand.shaderProgram=this._frontFaceColorCommand.shaderProgram&&this._frontFaceColorCommand.shaderProgram.destroy(),this._pickCommand.shaderProgram=this._pickCommand.shaderProgram&&this._pickCommand.shaderProgram.destroy(),this._pickId=this._pickId&&this._pickId.destroy(),l(this)},E}),t("ConicSensorVisualizer",["Cesium/Core/AssociativeArray","Cesium/Core/Cartesian3","Cesium/Core/Color","Cesium/Core/defined","Cesium/Core/destroyObject","Cesium/Core/DeveloperError","Cesium/Core/Math","Cesium/Core/Matrix3","Cesium/Core/Matrix4","Cesium/Core/Quaternion","Cesium/Core/Spherical","./CustomSensorVolume","Cesium/Scene/Material","Cesium/DataSources/MaterialProperty","Cesium/DataSources/Property"],function(e,i,t,r,n,o,s,a,l,u,c,h,d,m,C){"use strict";function f(e,i,t,n){var o=i[e];r(o)||(i[e]=o=new c),o.clock=t,o.cone=n,o.magnitude=1}function p(e,i,t,r,n){var o,a=e.directions,l=0,u=s.toRadians(2);if(0===i&&t===s.TWO_PI)for(o=0;o<s.TWO_PI;o+=u)f(l++,a,o,n);else{for(o=i;t>o;o+=u)f(l++,a,o,n);if(f(l++,a,t,n),r){for(o=t;o>i;o-=u)f(l++,a,o,r);f(l++,a,i,r)}else f(l++,a,t,0)}a.length=l,e.directions=a}function _(e,i,t){var n=i[e.id];if(r(n)){var o=n.primitive;t.remove(o),o.isDestroyed()||o.destroy(),delete i[e.id]}}var v=t.WHITE,g=1,S=Number.POSITIVE_INFINITY,y=new a,w=new i,A=new u,M=function(i,t){t.collectionChanged.addEventListener(M.prototype._onCollectionChanged,this),this._scene=i,this._primitives=i.primitives,this._entityCollection=t,this._hash={},this._entitiesToVisualize=new e,this._onCollectionChanged(t,t.entities,[],[])};return M.prototype.update=function(e){for(var t=this._entitiesToVisualize.values,n=this._hash,o=this._primitives,c=0,d=t.length;d>c;c++){var f,_,M=t[c],x=M._conicSensor,b=n[M.id],E=M.isAvailable(e)&&C.getValueOrDefault(x._show,e,!0);if(E&&(f=C.getValueOrUndefined(M._position,e,w),_=C.getValueOrUndefined(M._orientation,e,A),E=r(f)&&r(_)),E){var I=r(b)?b.primitive:void 0;r(I)||(I=new h,I.id=M,o.add(I),b={primitive:I,position:void 0,orientation:void 0,minimumClockAngle:void 0,maximumClockAngle:void 0,innerHalfAngle:void 0,outerHalfAngle:void 0},n[M.id]=b),i.equals(f,b.position)&&u.equals(_,b.orientation)||(l.fromRotationTranslation(a.fromQuaternion(_,y),f,I.modelMatrix),b.position=i.clone(f,b.position),b.orientation=u.clone(_,b.orientation)),I.show=!0;var V=C.getValueOrDefault(x._minimumClockAngle,e,0),D=C.getValueOrDefault(x._maximumClockAngle,e,s.TWO_PI),P=C.getValueOrDefault(x._innerHalfAngle,e,0),T=C.getValueOrDefault(x._outerHalfAngle,e,Math.PI);(V!==b.minimumClockAngle||D!==b.maximumClockAngle||P!==b.innerHalfAngle||T!==b.outerHalfAngle)&&(p(I,V,D,P,T),b.innerHalfAngle=P,b.maximumClockAngle=D,b.outerHalfAngle=T,b.minimumClockAngle=V),I.radius=C.getValueOrDefault(x._radius,e,S),I.lateralSurfaceMaterial=m.getValue(e,x._lateralSurfaceMaterial,I.lateralSurfaceMaterial),I.intersectionColor=C.getValueOrClonedDefault(x._intersectionColor,e,v,I.intersectionColor),I.intersectionWidth=C.getValueOrDefault(x._intersectionWidth,e,g)}else r(b)&&(b.primitive.show=!1)}return!0},M.prototype.isDestroyed=function(){return!1},M.prototype.destroy=function(){for(var e=this._entitiesToVisualize.values,i=this._hash,t=this._primitives,r=e.length-1;r>-1;r--)_(e[r],i,t);return n(this)},M.prototype._onCollectionChanged=function(e,i,t,n){var o,s,a=this._entitiesToVisualize,l=this._hash,u=this._primitives;for(o=i.length-1;o>-1;o--)s=i[o],r(s._conicSensor)&&r(s._position)&&r(s._orientation)&&a.set(s.id,s);for(o=n.length-1;o>-1;o--)s=n[o],r(s._conicSensor)&&r(s._position)&&r(s._orientation)?a.set(s.id,s):(_(s,l,u),a.remove(s.id));for(o=t.length-1;o>-1;o--)s=t[o],_(s,l,u),a.remove(s.id)},M}),t("CustomPatternSensorGraphics",["Cesium/Core/defaultValue","Cesium/Core/defined","Cesium/Core/defineProperties","Cesium/Core/DeveloperError","Cesium/Core/Event","Cesium/DataSources/createPropertyDescriptor"],function(e,i,t,r,n,o){"use strict";var s=function(){this._directions=void 0,this._directionsSubscription=void 0,this._lateralSurfaceMaterial=void 0,this._lateralSurfaceMaterialSubscription=void 0,this._intersectionColor=void 0,this._intersectionColorSubscription=void 0,this._intersectionWidth=void 0,this._intersectionWidthSubscription=void 0,this._showIntersection=void 0,this._showIntersectionSubscription=void 0,this._radius=void 0,this._radiusSubscription=void 0,this._show=void 0,this._showSubscription=void 0,this._definitionChanged=new n};return t(s.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},directions:o("directions"),lateralSurfaceMaterial:o("lateralSurfaceMaterial"),intersectionColor:o("intersectionColor"),intersectionWidth:o("intersectionWidth"),showIntersection:o("showIntersection"),radius:o("radius"),show:o("show")}),s.prototype.clone=function(e){return i(e)||(e=new s),e.directions=this.directions,e.radius=this.radius,e.show=this.show,e.showIntersection=this.showIntersection,e.intersectionColor=this.intersectionColor,e.intersectionWidth=this.intersectionWidth,e.lateralSurfaceMaterial=this.lateralSurfaceMaterial,e},s.prototype.merge=function(i){this.directions=e(this.directions,i.directions),this.radius=e(this.radius,i.radius),this.show=e(this.show,i.show),this.showIntersection=e(this.showIntersection,i.showIntersection),this.intersectionColor=e(this.intersectionColor,i.intersectionColor),this.intersectionWidth=e(this.intersectionWidth,i.intersectionWidth),this.lateralSurfaceMaterial=e(this.lateralSurfaceMaterial,i.lateralSurfaceMaterial)},s}),t("CustomPatternSensorVisualizer",["Cesium/Core/AssociativeArray","Cesium/Core/Cartesian3","Cesium/Core/Color","Cesium/Core/defaultValue","Cesium/Core/defined","Cesium/Core/destroyObject","Cesium/Core/DeveloperError","Cesium/Core/Math","Cesium/Core/Matrix3","Cesium/Core/Matrix4","Cesium/Core/Quaternion","Cesium/Core/Spherical","./CustomSensorVolume","Cesium/Scene/Material","Cesium/DataSources/MaterialProperty","Cesium/DataSources/Property"],function(e,i,t,r,n,o,s,a,l,u,c,h,d,m,C,f){"use strict";function p(e,i,t){var r=i[e.id];if(n(r)){var o=r.primitive;t.remove(o),o.isDestroyed()||o.destroy(),delete i[e.id]}}var _=t.WHITE,v=1,g=Number.POSITIVE_INFINITY,S=new l,y=new i,w=new c,A=function(i,t){t.collectionChanged.addEventListener(A.prototype._onCollectionChanged,this),this._scene=i,this._primitives=i.primitives,this._entityCollection=t,this._hash={},this._entitiesToVisualize=new e,this._onCollectionChanged(t,t.entities,[],[])};return A.prototype.update=function(e){for(var t=this._entitiesToVisualize.values,r=this._hash,o=this._primitives,s=0,a=t.length;a>s;s++){var h,m,p,A=t[s],M=A._customPatternSensor,x=r[A.id],b=A.isAvailable(e)&&f.getValueOrDefault(M._show,e,!0);if(b&&(h=f.getValueOrUndefined(A._position,e,y),m=f.getValueOrUndefined(A._orientation,e,w),p=f.getValueOrUndefined(M._directions,e),b=n(h)&&n(m)&&n(p)),b){var E=n(x)?x.primitive:void 0;n(E)||(E=new d,E.id=A,o.add(E),x={primitive:E,position:void 0,orientation:void 0},r[A.id]=x),i.equals(h,x.position)&&c.equals(m,x.orientation)||(u.fromRotationTranslation(l.fromQuaternion(m,S),h,E.modelMatrix),x.position=i.clone(h,x.position),x.orientation=c.clone(m,x.orientation)),E.show=!0,E.directions=p,E.radius=f.getValueOrDefault(M._radius,e,g),E.lateralSurfaceMaterial=C.getValue(e,M._lateralSurfaceMaterial,E.lateralSurfaceMaterial),E.intersectionColor=f.getValueOrClonedDefault(M._intersectionColor,e,_,E.intersectionColor),E.intersectionWidth=f.getValueOrDefault(M._intersectionWidth,e,v)}else n(x)&&(x.primitive.show=!1)}return!0},A.prototype.isDestroyed=function(){return!1},A.prototype.destroy=function(){for(var e=this._entitiesToVisualize.values,i=this._hash,t=this._primitives,r=e.length-1;r>-1;r--)p(e[r],i,t);return o(this)},A.prototype._onCollectionChanged=function(e,i,t,r){var o,s,a=this._entitiesToVisualize,l=this._hash,u=this._primitives;for(o=i.length-1;o>-1;o--)s=i[o],n(s._customPatternSensor)&&n(s._position)&&n(s._orientation)&&a.set(s.id,s);for(o=r.length-1;o>-1;o--)s=r[o],n(s._customPatternSensor)&&n(s._position)&&n(s._orientation)?a.set(s.id,s):(p(s,l,u),a.remove(s.id));for(o=t.length-1;o>-1;o--)s=t[o],p(s,l,u),a.remove(s.id)},A}),t("RectangularSensorGraphics",["Cesium/Core/defaultValue","Cesium/Core/defined","Cesium/Core/defineProperties","Cesium/Core/DeveloperError","Cesium/Core/Event","Cesium/DataSources/createPropertyDescriptor"],function(e,i,t,r,n,o){"use strict";var s=function(){this._xHalfAngle=void 0,this._xHalfAngleSubscription=void 0,this._yHalfAngle=void 0,this._yHalfAngleSubscription=void 0,this._lateralSurfaceMaterial=void 0,this._lateralSurfaceMaterialSubscription=void 0,this._intersectionColor=void 0,this._intersectionColorSubscription=void 0,this._intersectionWidth=void 0,this._intersectionWidthSubscription=void 0,this._showIntersection=void 0,this._showIntersectionSubscription=void 0,this._radius=void 0,this._radiusSubscription=void 0,this._show=void 0,this._showSubscription=void 0,this._definitionChanged=new n};return t(s.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},xHalfAngle:o("xHalfAngle"),yHalfAngle:o("yHalfAngle"),lateralSurfaceMaterial:o("lateralSurfaceMaterial"),intersectionColor:o("intersectionColor"),intersectionWidth:o("intersectionWidth"),showIntersection:o("showIntersection"),radius:o("radius"),show:o("show")}),s.prototype.clone=function(e){return i(e)||(e=new s),e.xHalfAngle=this.xHalfAngle,e.yHalfAngle=this.yHalfAngle,e.radius=this.radius,e.show=this.show,e.showIntersection=this.showIntersection,e.intersectionColor=this.intersectionColor,e.intersectionWidth=this.intersectionWidth,e.lateralSurfaceMaterial=this.lateralSurfaceMaterial,e},s.prototype.merge=function(i){this.xHalfAngle=e(this.xHalfAngle,i.xHalfAngle),this.yHalfAngle=e(this.yHalfAngle,i.yHalfAngle),this.radius=e(this.radius,i.radius),this.show=e(this.show,i.show),this.showIntersection=e(this.showIntersection,i.showIntersection),this.intersectionColor=e(this.intersectionColor,i.intersectionColor),this.intersectionWidth=e(this.intersectionWidth,i.intersectionWidth),this.lateralSurfaceMaterial=e(this.lateralSurfaceMaterial,i.lateralSurfaceMaterial)},s}),t("RectangularSensorVisualizer",["Cesium/Core/AssociativeArray","Cesium/Core/Cartesian3","Cesium/Core/Color","Cesium/Core/defaultValue","Cesium/Core/defined","Cesium/Core/destroyObject","Cesium/Core/DeveloperError","Cesium/Core/Math","Cesium/Core/Matrix3","Cesium/Core/Matrix4","Cesium/Core/Quaternion","Cesium/Core/Spherical","./CustomSensorVolume","Cesium/Scene/Material","Cesium/DataSources/MaterialProperty","Cesium/DataSources/Property"],function(e,i,t,r,n,o,s,a,l,u,c,h,d,m,C,f){"use strict";function p(e,i,t,r){var o=i[e];n(o)||(i[e]=o=new h),o.clock=t,o.cone=r,o.magnitude=1}function _(e,i,t){var r=e.directions,n=Math.tan(Math.min(i,a.toRadians(89))),o=Math.tan(Math.min(t,a.toRadians(89))),s=Math.atan(n/o),l=Math.atan(Math.sqrt(n*n+o*o));p(0,r,s,l),p(1,r,a.toRadians(180)-s,l),p(2,r,a.toRadians(180)+s,l),p(3,r,-s,l),r.length=4,e.directions=r}function v(e,i,t){var r=i[e.id];if(n(r)){var o=r.primitive;t.remove(o),o.isDestroyed()||o.destroy(),delete i[e.id]}}var g=t.WHITE,S=1,y=Number.POSITIVE_INFINITY,w=new l,A=new i,M=new c,x=function(i,t){t.collectionChanged.addEventListener(x.prototype._onCollectionChanged,this),this._scene=i,this._primitives=i.primitives,this._entityCollection=t,this._hash={},this._entitiesToVisualize=new e,this._onCollectionChanged(t,t.entities,[],[])};return x.prototype.update=function(e){for(var t=this._entitiesToVisualize.values,r=this._hash,o=this._primitives,s=0,h=t.length;h>s;s++){var m,p,v=t[s],x=v._rectangularSensor,b=r[v.id],E=v.isAvailable(e)&&f.getValueOrDefault(x._show,e,!0);if(E&&(m=f.getValueOrUndefined(v._position,e,A),p=f.getValueOrUndefined(v._orientation,e,M),E=n(m)&&n(p)),E){var I=n(b)?b.primitive:void 0;n(I)||(I=new d,I.id=v,o.add(I),b={primitive:I,position:void 0,orientation:void 0,xHalfAngle:void 0,yHalfAngle:void 0},r[v.id]=b),i.equals(m,b.position)&&c.equals(p,b.orientation)||(u.fromRotationTranslation(l.fromQuaternion(p,w),m,I.modelMatrix),b.position=i.clone(m,b.position),b.orientation=c.clone(p,b.orientation)),I.show=!0;var V=f.getValueOrDefault(x._xHalfAngle,e,a.PI_OVER_TWO),D=f.getValueOrDefault(x._yHalfAngle,e,a.PI_OVER_TWO);(V!==b.xHalfAngle||D!==b.yHalfAngle)&&(_(I,V,D),b.xHalfAngle=V,b.yHalfAngle=D),I.radius=f.getValueOrDefault(x._radius,e,y),I.lateralSurfaceMaterial=C.getValue(e,x._lateralSurfaceMaterial,I.lateralSurfaceMaterial),I.intersectionColor=f.getValueOrClonedDefault(x._intersectionColor,e,g,I.intersectionColor),I.intersectionWidth=f.getValueOrDefault(x._intersectionWidth,e,S)}else n(b)&&(b.primitive.show=!1)}return!0},x.prototype.isDestroyed=function(){return!1},x.prototype.destroy=function(){for(var e=this._entitiesToVisualize.values,i=this._hash,t=this._primitives,r=e.length-1;r>-1;r--)v(e[r],i,t);return o(this)},x.prototype._onCollectionChanged=function(e,i,t,r){var o,s,a=this._entitiesToVisualize,l=this._hash,u=this._primitives;for(o=i.length-1;o>-1;o--)s=i[o],n(s._rectangularSensor)&&n(s._position)&&n(s._orientation)&&a.set(s.id,s);for(o=r.length-1;o>-1;o--)s=r[o],n(s._rectangularSensor)&&n(s._position)&&n(s._orientation)?a.set(s.id,s):(v(s,l,u),a.remove(s.id));for(o=t.length-1;o>-1;o--)s=t[o],v(s,l,u),a.remove(s.id)},x}),t("initialize",["Cesium/Core/Cartesian3","Cesium/Core/Color","Cesium/Core/defined","Cesium/Core/Spherical","Cesium/Core/TimeInterval","Cesium/DataSources/CzmlDataSource","Cesium/DataSources/DataSourceDisplay","./ConicSensorGraphics","./ConicSensorVisualizer","./CustomPatternSensorGraphics","./CustomPatternSensorVisualizer","./RectangularSensorGraphics","./RectangularSensorVisualizer"],function(e,i,t,r,n,o,s,a,l,u,c,h,d){"use strict";
function m(i,n,o,s,a){var l,u,c=[],h=n.unitSpherical,d=n.spherical,m=n.unitCartesian,C=n.cartesian;if(t(h)){for(l=0,u=h.length;u>l;l+=2)c.push(new r(h[l],h[l+1]));n.array=c}else if(t(d)){for(l=0,u=d.length;u>l;l+=3)c.push(new r(d[l],d[l+1],d[l+2]));n.array=c}else if(t(m)){for(l=0,u=m.length;u>l;l+=3){var f=r.fromCartesian3(new e(m[l],m[l+1],m[l+2]));r.normalize(f,f),c.push(f)}n.array=c}else if(t(C)){for(l=0,u=C.length;u>l;l+=3)c.push(r.fromCartesian3(new e(C[l],C[l+1],C[l+2])));n.array=c}v(Array,i,"directions",n,o,s,a)}function C(e,t,r,n,o){v(Boolean,e,"show",t.show,r,n,o),v(Number,e,"radius",t.radius,r,n,o),v(Boolean,e,"showIntersection",t.showIntersection,r,n,o),v(i,e,"intersectionColor",t.intersectionColor,r,n,o),v(Number,e,"intersectionWidth",t.intersectionWidth,r,n,o),g(e,"lateralSurfaceMaterial",t.lateralSurfaceMaterial,r,n,o)}function f(e,i,r,o){var s=i.agi_conicSensor;if(t(s)){var l,u=s.interval;t(u)&&(S.iso8601=u,l=n.fromIso8601(S));var c=e.conicSensor;t(c)||(e.addProperty("conicSensor"),e.conicSensor=c=new a),C(c,s,l,o,r),v(Number,c,"innerHalfAngle",s.innerHalfAngle,l,o,r),v(Number,c,"outerHalfAngle",s.outerHalfAngle,l,o,r),v(Number,c,"minimumClockAngle",s.minimumClockAngle,l,o,r),v(Number,c,"maximumClockAngle",s.maximumClockAngle,l,o,r)}}function p(e,i,r,o){var s=i.agi_customPatternSensor;if(t(s)){var a,l=s.interval;t(l)&&(S.iso8601=l,a=n.fromIso8601(S));var c=e.customPatternSensor;t(c)||(e.addProperty("customPatternSensor"),e.customPatternSensor=c=new u),C(c,s,a,o,r);var h=s.directions;if(t(h))if(Array.isArray(h))for(var d=h.length,f=0;d>f;f++)m(c,h[f],a,o,r);else m(c,h,a,o,r)}}function _(e,i,r,o){var s=i.agi_rectangularSensor;if(t(s)){var a,l=s.interval;t(l)&&(S.iso8601=l,a=n.fromIso8601(S));var u=e.rectangularSensor;t(u)||(e.addProperty("rectangularSensor"),e.rectangularSensor=u=new h),C(u,s,a,o,r),v(Number,u,"xHalfAngle",s.xHalfAngle,a,o,r),v(Number,u,"yHalfAngle",s.yHalfAngle,a,o,r)}}var v=o.processPacketData,g=o.processMaterialPacketData,S={iso8601:void 0},y=!1,w=function(){if(!y){o.updaters.push(f,p,_);var e=s.defaultVisualizersCallback;s.defaultVisualizersCallback=function(i,t){var r=t.entities,n=e(i,t);return n.concat([new l(i,r),new c(i,r),new d(i,r)])},y=!0}};return w}),t("CesiumSensors",["./initialize","./ConicSensorGraphics","./ConicSensorVisualizer","./CustomPatternSensorGraphics","./CustomPatternSensorVisualizer","./CustomSensorVolume","./RectangularSensorGraphics","./RectangularSensorVisualizer"],function(e,i,t,r,n,o,s,a){"use strict";return e(),{ConicSensorGraphics:i,ConicSensorVisualizer:t,CustomPatternSensorGraphics:r,CustomPatternSensorVisualizer:n,CustomSensorVolume:o,RectangularSensorGraphics:s,RectangularSensorVisualizer:a}}),function(){"use strict";t("Cesium/Core/defaultValue",function(){return Cesium.defaultValue}),t("Cesium/Core/defined",function(){return Cesium.defined}),t("Cesium/Core/defineProperties",function(){return Cesium.defineProperties}),t("Cesium/Core/DeveloperError",function(){return Cesium.DeveloperError}),t("Cesium/Core/Event",function(){return Cesium.Event}),t("Cesium/DataSources/createPropertyDescriptor",function(){return Cesium.createPropertyDescriptor}),t("Cesium/Core/AssociativeArray",function(){return Cesium.AssociativeArray}),t("Cesium/Core/Cartesian3",function(){return Cesium.Cartesian3}),t("Cesium/Core/Color",function(){return Cesium.Color}),t("Cesium/Core/destroyObject",function(){return Cesium.destroyObject}),t("Cesium/Core/Math",function(){return Cesium.Math}),t("Cesium/Core/Matrix3",function(){return Cesium.Matrix3}),t("Cesium/Core/Matrix4",function(){return Cesium.Matrix4}),t("Cesium/Core/Quaternion",function(){return Cesium.Quaternion}),t("Cesium/Core/Spherical",function(){return Cesium.Spherical}),t("Cesium/Scene/Material",function(){return Cesium.Material}),t("Cesium/DataSources/MaterialProperty",function(){return Cesium.MaterialProperty}),t("Cesium/DataSources/Property",function(){return Cesium.Property}),t("Cesium/Core/BoundingSphere",function(){return Cesium.BoundingSphere}),t("Cesium/Core/combine",function(){return Cesium.combine}),t("Cesium/Core/ComponentDatatype",function(){return Cesium.ComponentDatatype}),t("Cesium/Core/PrimitiveType",function(){return Cesium.PrimitiveType}),t("Cesium/Renderer/BufferUsage",function(){return Cesium.BufferUsage}),t("Cesium/Renderer/createShaderSource",function(){return Cesium.createShaderSource}),t("Cesium/Renderer/DrawCommand",function(){return Cesium.DrawCommand}),t("Cesium/Scene/BlendingState",function(){return Cesium.BlendingState}),t("Cesium/Scene/CullFace",function(){return Cesium.CullFace}),t("Cesium/Scene/Pass",function(){return Cesium.Pass}),t("Cesium/Scene/SceneMode",function(){return Cesium.SceneMode}),t("Cesium/Core/TimeInterval",function(){return Cesium.TimeInterval}),t("Cesium/DataSources/CzmlDataSource",function(){return Cesium.CzmlDataSource}),t("Cesium/DataSources/DataSourceDisplay",function(){return Cesium.DataSourceDisplay}),i(["CesiumSensors"],function(e){var i="undefined"!=typeof window?window:"undefined"!=typeof self?self:{};i.CesiumSensors=e},void 0,!0)}()}();